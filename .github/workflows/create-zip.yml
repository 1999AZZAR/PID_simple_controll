name: Create Source Code ZIP (Manual)

# This workflow creates a ZIP file of ONLY the source code (no compiled firmware)
# Use this for manual ZIP creation when you don't need compiled binaries
# For complete packages with firmware, use the Compile Arduino Sketches workflow

on:
  workflow_dispatch:  # Manual trigger only

jobs:
  create-source-zip:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Get current date
      id: date
      run: echo "date=$(date +'%d%m%Y')" >> $GITHUB_OUTPUT

    - name: Get repository name
      id: repo
      run: echo "name=${GITHUB_REPOSITORY#*/}" >> $GITHUB_OUTPUT

    - name: Create source code ZIP (no compiled files)
      run: |
        # Create ZIP of source code only (exclude compiled files)
        zip -r ${{ steps.date.outputs.date }}_${{ steps.repo.outputs.name }}_source.zip . \
        -x "*.git*" \
        -x ".github/*" \
        -x "*/compiled/*" \
        --quiet

        echo "Source ZIP created: ${{ steps.date.outputs.date }}_${{ steps.repo.outputs.name }}_source.zip"
        ls -lh ${{ steps.date.outputs.date }}_${{ steps.repo.outputs.name }}_source.zip

    - name: Upload source ZIP as artifact
      uses: actions/upload-artifact@v4
      with:
        name: source-code-package
        path: ${{ steps.date.outputs.date }}_${{ steps.repo.outputs.name }}_source.zip
